#!/usr/bin/env bash
# Displays DNS A record info for a domain and its subdomains

domain=$1
subdomain=$2

get_record_info() {
  local sub=$1
  local query="${sub}.${domain}"
  local answer

  # shellcheck disable=SC2086
  answer=$(dig +noall +answer ${query})

  if [ -n "$answer" ]; then
    local parsed
    parsed=$(awk 'NR==1 {print $4 " " $5}' <<< "$answer")
    local record_type destination
    read -r record_type destination <<< "$parsed"
    echo "The subdomain ${sub} is a ${record_type} record and points to ${destination}"
  fi
}

if [ -z "$domain" ]; then
  echo "Usage: $0 domain [subdomain]"
  exit 1
fi

if [ -z "$subdomain" ]; then
  for sub in www lb-01 web-01 web-02; do
    get_record_info "$sub"
  done
else
  get_record_info "$subdomain"
fi
